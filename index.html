<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CBT ï¼ˆ30å•ï¼‰</title>
  <style>
    :root{--bg:#0b1020;--panel:#121a33;--accent:#6aa1ff;--text:#e9eefc;--muted:#a8b3d6;--danger:#ff6a7a;--good:#5ad39d}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(160deg,#0b1020,#101830 55%,#0b1020);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .container{max-width:840px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:16px}
    .brand{font-weight:700;letter-spacing:.3px}
    .panel{background:var(--panel);border:1px solid rgba(255,255,255,.05);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:20px}
    .muted{color:var(--muted)}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:12px}
    .progress{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#b782ff);width:0}
    .question-card{display:grid;gap:16px}
    fieldset{border:0;margin:0;padding:0}
    legend{font-weight:700;font-size:20px;margin-bottom:8px}
    .opts{display:grid;gap:10px}
    .opt{display:flex;align-items:center;gap:10px;padding:12px 14px;border:1px solid rgba(255,255,255,.08);border-radius:14px;cursor:pointer;background:rgba(255,255,255,.02)}
    .opt input{accent-color:var(--accent)}
    .opt.correct{outline:2px solid var(--good);background:rgba(90,211,157,.08)}
    .opt.wrong{outline:2px solid var(--danger);background:rgba(255,106,122,.08)}
    .nav{display:flex;gap:10px;justify-content:space-between;margin-top:6px}
    button{appearance:none;border:0;border-radius:14px;padding:12px 16px;font-weight:600;cursor:pointer;background:var(--accent);color:#081225;box-shadow:0 6px 18px rgba(106,161,255,.35)}
    button.secondary{background:rgba(255,255,255,.08);color:var(--text);box-shadow:none;border:1px solid rgba(255,255,255,.12)}
    button:disabled{opacity:.5;cursor:not-allowed}
    .timer{font-variant-numeric:tabular-nums}
    .kbd{font-variant-numeric:tabular-nums;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);padding:1px 6px;border-radius:6px;font-size:12px}
    .footer{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .result{display:grid;gap:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .stat{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);padding:14px;border-radius:14px}
    .explain{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:12px;margin-top:8px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    a.link{color:#a2c4ff}
    /* === å…¥åŠ›æ–‡å­—ã®è¦–èªæ€§ã‚’æ”¹å–„ === */
    input.opt{display:block;width:100%;color:var(--text);background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.22);padding:12px 14px;border-radius:12px;font-size:16px;line-height:1.4;caret-color:var(--accent);cursor:text}
    input.opt::placeholder{color:var(--muted);opacity:.95}
    input.opt:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(106,161,255,.28);background:rgba(255,255,255,.14)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">CBT ä¸€å•ä¸€ç­”</div>
      <div class="chip"><span aria-hidden>ğŸ•’</span><span class="timer" id="timer" aria-live="polite">--:--</span></div>
    </header>

    <div class="panel" aria-live="polite">
      <div class="progress" aria-hidden="true"><span id="progress"></span></div>
      <div class="muted" id="meta" style="margin:10px 0 16px"></div>
      <div id="screen"></div>
    </div>

    <div class="footer" style="margin-top:12px">
      <div class="muted">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: <span class="kbd">1-9</span> é¸æŠ / <span class="kbd">Enter</span> æ¬¡ã¸</div>
      <div class="muted">é€²æ—ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
    </div>
  </div>

<script>
/********************
 * è¨­å®š
 ********************/
const CONFIG = {
  title: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼†æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ åŸºç¤30å•',
  timeLimitMinutes: 50,
  shuffleQuestions: true,
  shuffleOptions: true,
  allowReviewBeforeSubmit: true,
  showExplanationAfterSubmit: true,
  persistKey: 'cbt-state-v1-30'
};

/********************
 * å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ30å•ã«å†ç·¨ï¼‰
 * type: 'single'ï¼ˆå˜ä¸€é¸æŠï¼‰/ 'short'ï¼ˆçŸ­ç­”å…¥åŠ›ï¼‰
 ********************/
const QUESTIONS = [
  // --- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤ï¼ˆ15å•ï¼‰ ---
  {id:'q1', type:'short', stem:'å­¦æ ¡ã‚„ä¼šç¤¾ãªã©ã®é™ã‚‰ã‚ŒãŸç¯„å›²ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(LAN|ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯|Local Area Network|ï¼¬ï¼¡ï¼®)$/i, explanation:'é™å®šã•ã‚ŒãŸç¯„å›²ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯LANã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤'], difficulty:1},
  {id:'q2', type:'short', stem:'LANã©ã†ã—ã‚’åºƒã„ç¯„å›²ã§çµã‚“ã ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(WAN|ãƒ¯ã‚¤ãƒ‰ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯|Wide Area Network|ï¼·ï¼¡ï¼®)$/i, explanation:'åºƒåŸŸã‚’çµã¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯WANã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤'], difficulty:1},
  {id:'q3', type:'short', stem:'ä¸–ç•Œä¸­ã®LANã‚„WANãŒæ¥ç¶šã•ã‚Œã€ä¸–ç•Œè¦æ¨¡ã«ç™ºå±•ã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ|Internet)$/i, explanation:'ä¸–ç•Œè¦æ¨¡ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤'], difficulty:1},
  {id:'q4', type:'short', stem:'ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦æ±‚ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒã‹ã‚‰ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ[-ï¼/âˆ’]?ã‚µãƒ¼ãƒ(?:ã‚·ã‚¹ãƒ†ãƒ )?|Client(?:-| )?Server(?: System)?)$/i, explanation:'ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤'], difficulty:1},
  {id:'q5', type:'short', stem:'æƒ…å ±ä¼é”ã«ãŠã‘ã‚‹ç´„æŸã”ã¨ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ—ãƒ­ãƒˆã‚³ãƒ«|é€šä¿¡è¦ç´„|protocol)$/i, explanation:'é€šä¿¡ã®å–ã‚Šæ±ºã‚ã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤','ãƒ—ãƒ­ãƒˆã‚³ãƒ«'], difficulty:1},
  {id:'q6', type:'short', stem:'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ç”¨ã„ã‚‰ã‚Œã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç¾¤ã§ã€TCPã¨IPã®2ã¤ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä¸­å¿ƒã¨ã™ã‚‹ã‚‚ã®ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^TCP[/]IP$/i, explanation:'TCP/IPã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤','ãƒ—ãƒ­ãƒˆã‚³ãƒ«'], difficulty:1},
  {id:'q7', type:'short', stem:'TCP/IPã«ãŠã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§ã‚’ä¿è¨¼ã™ã‚‹å½¹å‰²ã‚’æŒã¤ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ä½•ã§ã™ã‹ï¼Ÿ', answerPattern:/^TCP$/i, explanation:'ä¿¡é ¼æ€§ã¨å†é€åˆ¶å¾¡ãªã©ã‚’æ‹…ã†ã®ã¯TCPã§ã™ã€‚', tags:['TCP/IP'], difficulty:1},
  {id:'q8', type:'short', stem:'TCP/IPã«ãŠã„ã¦ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”¨ã„ã¦ãƒ‘ã‚±ãƒƒãƒˆã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹å½¹å‰²ã‚’æŒã¤ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ä½•ã§ã™ã‹ï¼Ÿ', answerPattern:/^IP$/i, explanation:'çµŒè·¯åˆ¶å¾¡ã®å˜ä½ã¨ãªã‚‹ãƒ‘ã‚±ãƒƒãƒˆã‚’æ‰±ã†ã®ã¯IPã§ã™ã€‚', tags:['TCP/IP'], difficulty:1},
  {id:'q9', type:'short', stem:'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒæŒã£ã¦ã„ã‚‹å€‹åˆ¥ã®ç•ªå·ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(IPã‚¢ãƒ‰ãƒ¬ã‚¹|IP address)$/i, explanation:'å€‹ä½“è­˜åˆ¥ã®ãŸã‚ã®ç•ªå·ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚', tags:['TCP/IP','IP'], difficulty:1},
  {id:'q10', type:'short', stem:'IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’32ãƒ“ãƒƒãƒˆã§æ§‹æˆã—ã€8ãƒ“ãƒƒãƒˆãšã¤ãƒ‰ãƒƒãƒˆã§åŒºåˆ‡ã£ã¦è¡¨ç¾ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^IPv?4$/i, explanation:'32ãƒ“ãƒƒãƒˆã®IPã¯IPv4ã§ã™ã€‚', tags:['TCP/IP','IP'], difficulty:1},
  {id:'q13', type:'short', stem:'IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’äººé–“ã«ã¨ã£ã¦åˆ†ã‹ã‚Šã‚„ã™ã„åå‰ã«ä»˜ã‘æ›¿ãˆãŸã‚‚ã®ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ‰ãƒ¡ã‚¤ãƒ³å|domain name)$/i, explanation:'äººãŒæ‰±ã„ã‚„ã™ã„åå‰ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³åã§ã™ã€‚', tags:['DNS'], difficulty:1},
  {id:'q14', type:'short', stem:'ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›¸äº’ã«å¤‰æ›ã™ã‚‹ã‚µãƒ¼ãƒã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(DNSã‚µãƒ¼ãƒ|DNS ã‚µãƒ¼ãƒ|ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒ|name server|DNS server)$/i, explanation:'DNSã‚µãƒ¼ãƒï¼ˆãƒãƒ¼ãƒ ã‚µãƒ¼ãƒï¼‰ãŒå¤‰æ›ã‚’è¡Œã„ã¾ã™ã€‚', tags:['DNS'], difficulty:1},
  {id:'q15', type:'short', stem:'ãƒ‘ã‚±ãƒƒãƒˆè»¢é€ç”¨ã®é€šä¿¡çµŒè·¯ã®ä¸­ã‹ã‚‰ã€æœ€é©ãªçµŒè·¯ã‚’é¸æŠã™ã‚‹ä»•çµ„ã¿ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°|routing)$/i, explanation:'çµŒè·¯é¸æŠã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã™ã€‚', tags:['ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°'], difficulty:1},
  {id:'q16', type:'short', stem:'ãƒ«ãƒ¼ã‚¿å†…ã«ã‚ã‚Šã€ãƒ‘ã‚±ãƒƒãƒˆã®è»¢é€çµŒè·¯ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚’ã¾ã¨ã‚ãŸè¡¨ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«|routing table)$/i, explanation:'çµŒè·¯æƒ…å ±ã‚’ä¿æŒã™ã‚‹è¡¨ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚', tags:['ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°'], difficulty:1},
  {id:'q18', type:'short', stem:'Webãƒšãƒ¼ã‚¸ã®é–²è¦§ã«ä½¿ã‚ã‚Œã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ä½•ã§ã™ã‹ï¼Ÿ', answerPattern:/^HTTP$/i, explanation:'é–²è¦§ã«ã¯HTTPãŒç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚', tags:['Web','ãƒ—ãƒ­ãƒˆã‚³ãƒ«'], difficulty:1},

  // --- æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆ15å•ï¼‰ ---
  {id:'q27', type:'short', stem:'æƒ…å ±ã®ã€Œæ©Ÿå¯†æ€§ã€ã€Œå®Œå…¨æ€§ã€ã€Œå¯ç”¨æ€§ã€ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£|information security)$/i, explanation:'3è¦ç´ ã‚’å®ˆã‚‹ã®ãŒæƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§ã™ã€‚', tags:['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç¤'], difficulty:1},
  {id:'q28', type:'short', stem:'ã‚ã‚‹æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’èªã‚ã‚‰ã‚ŒãŸäººã ã‘ãŒã€ãã®æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã‚’ä½•ã¨ã„ã„ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(æ©Ÿå¯†æ€§|confidentiality)$/i, explanation:'CIAã®Cã¯æ©Ÿå¯†æ€§ã§ã™ã€‚', tags:['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç¤'], difficulty:1},
  {id:'q29', type:'short', stem:'æƒ…å ±ãŒç ´å£Šã€æ”¹ã–ã‚“ã€ã¾ãŸã¯æ¶ˆå»ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã‚’ä½•ã¨ã„ã„ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(å®Œå…¨æ€§|integrity)$/i, explanation:'CIAã®Iã¯å®Œå…¨æ€§ã§ã™ã€‚', tags:['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç¤'], difficulty:1},
  {id:'q30', type:'short', stem:'èªã‚ã‚‰ã‚ŒãŸäººãŒã€å¿…è¦ãªæ™‚ã«ä¸­æ–­ã™ã‚‹ã“ã¨ãªãæƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã‚’ä½•ã¨ã„ã„ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(å¯ç”¨æ€§|availability)$/i, explanation:'CIAã®Aã¯å¯ç”¨æ€§ã§ã™ã€‚', tags:['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç¤'], difficulty:1},
  {id:'q31', type:'short', stem:'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã€æ­£è¦ã®åˆ©ç”¨è€…ã§ã‚ã‚‹ã“ã¨ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ¦ãƒ¼ã‚¶(?:ãƒ¼)?ID|ãƒ¦ãƒ¼ã‚¶ãƒ¼ID|ãƒ¦ãƒ¼ã‚¶ID|user id)$/i, explanation:'è­˜åˆ¥å­ã¯ãƒ¦ãƒ¼ã‚¶IDã§ã™ã€‚', tags:['ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ'], difficulty:1},
  {id:'q32', type:'short', stem:'ãƒ¦ãƒ¼ã‚¶IDã¨çµ„ã¿åˆã‚ã›ã¦ã€æœ¬äººã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã‚‹ã‚‚ã®ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰|password)$/i, explanation:'èªè¨¼è¦ç´ ã®ä¸€ã¤ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚', tags:['ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ'], difficulty:1},
  {id:'q33', type:'short', stem:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç›—ã¿è¦‹ãªã©ã€äººç‚ºçš„ãªæ‰‹æ®µã§æ©Ÿå¯†æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹è¡Œç‚ºã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°|social engineering)$/i, explanation:'äººã®å¿ƒç†ã‚„ä¸æ³¨æ„ã‚’çªãæ”»æ’ƒã§ã™ã€‚', tags:['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç¤'], difficulty:1},
  {id:'q34', type:'short', stem:'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹æ‰‹ã«æš—å·åŒ–ã—ã€è§£é™¤ã¨å¼•ãæ›ãˆã«é‡‘éŠ­ã‚’è¦æ±‚ã™ã‚‹ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ©ãƒ³ã‚µãƒ ã‚¦ã‚§ã‚¢|ransomware)$/i, explanation:'èº«ä»£é‡‘è¦æ±‚å‹ãƒãƒ«ã‚¦ã‚§ã‚¢ã§ã™ã€‚', tags:['ãƒãƒ«ã‚¦ã‚§ã‚¢'], difficulty:1},
  {id:'q35', type:'short', stem:'æƒ…å ±ã‚’å‹æ‰‹ã«å¤–éƒ¨ã«é€ä¿¡ã—ã¦ã—ã¾ã†ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ã‚¹ãƒ‘ã‚¤ã‚¦ã‚§ã‚¢|spyware)$/i, explanation:'æƒ…å ±æ¼ãˆã„ã‚’ç‹™ã†ã‚¹ãƒ‘ã‚¤ã‚¦ã‚§ã‚¢ã§ã™ã€‚', tags:['ãƒãƒ«ã‚¦ã‚§ã‚¢'], difficulty:1},
  {id:'q37', type:'short', stem:'ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è„†å¼±æ€§ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«æä¾›ã•ã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒ|security patch)$/i, explanation:'ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã§ã™ã€‚', tags:['è„†å¼±æ€§å¯¾ç­–'], difficulty:1},
  {id:'q38', type:'short', stem:'å¤–éƒ¨ã‹ã‚‰ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–“ã«è¨­ç½®ã™ã‚‹è£…ç½®ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ç·ç§°ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«|ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«|firewall)$/i, explanation:'å¢ƒç•Œã§åˆ¶å¾¡ã™ã‚‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ã™ã€‚', tags:['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£'], difficulty:1},
  {id:'q39', type:'short', stem:'ä¼æ¥­ã‚„çµ„ç¹”ã«ãŠã‘ã‚‹ã€æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®æ–¹é‡ã‚„è¡Œå‹•æŒ‡é‡ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼|security policy|information security policy)$/i, explanation:'çµ„ç¹”ã®æ–¹é‡ã¯æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚', tags:['ã‚¬ãƒãƒŠãƒ³ã‚¹'], difficulty:1},
  {id:'q42', type:'short', stem:'ç¬¬ä¸‰è€…ã«å†…å®¹ãŒã‚ã‹ã‚‰ãªã„ã‚ˆã†ã«ã€ä¸€å®šã®è¦å‰‡ã«å¾“ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›ã™ã‚‹æŠ€è¡“ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(æš—å·åŒ–|encryption)$/i, explanation:'ç§˜åŒ¿åŒ–ã®ãŸã‚ã®æš—å·åŒ–ã§ã™ã€‚', tags:['æš—å·'], difficulty:1},
  {id:'q45', type:'short', stem:'æš—å·åŒ–ã¨å¾©å·ã«åŒã˜éµã‚’ä½¿ã†æš—å·æ–¹å¼ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(å…±é€šéµæš—å·(?:æ–¹å¼)?|å¯¾ç§°éµæš—å·(?:æ–¹å¼)?|symmetric key(?: cryptography| encryption)?)$/i, explanation:'åŒä¸€éµã‚’ç”¨ã„ã‚‹ã®ã¯å…±é€šéµï¼ˆå¯¾ç§°éµï¼‰æš—å·ã§ã™ã€‚', tags:['æš—å·'], difficulty:1},
  {id:'q46', type:'short', stem:'æš—å·åŒ–ã«ä½¿ã†ã€Œå…¬é–‹éµã€ã¨ã€å¾©å·ã«ä½¿ã†ã€Œç§˜å¯†éµã€ã¨ã„ã†ç•°ãªã‚‹éµã®ãƒšã‚¢ã‚’ä½¿ã†æ–¹å¼ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(å…¬é–‹éµæš—å·(?:æ–¹å¼)?|éå¯¾ç§°éµæš—å·(?:æ–¹å¼)?|public key(?: cryptography| encryption)?)$/i, explanation:'ç•°ãªã‚‹éµã‚’ä½¿ã†ã®ã¯å…¬é–‹éµï¼ˆéå¯¾ç§°éµï¼‰æš—å·ã§ã™ã€‚', tags:['æš—å·'], difficulty:1},
  {id:'q47', type:'short', stem:'å…¬é–‹éµæš—å·æ–¹å¼ã®æ€§è³ªã‚’å¿œç”¨ã—ã€ç™ºä¿¡è€…ãŒæœ¬äººã§ã‚ã‚‹ã“ã¨ã‚’è¨¼æ˜ã™ã‚‹æ–¹æ³•ã‚’ä½•ã¨å‘¼ã³ã¾ã™ã‹ï¼Ÿ', answerPattern:/^(ãƒ‡ã‚¸ã‚¿ãƒ«ç½²å|é›»å­ç½²å|digital signature)$/i, explanation:'æœ¬äººæ€§ã¨æ”¹ã–ã‚“æ¤œçŸ¥ã«ç”¨ã„ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã§ã™ã€‚', tags:['æš—å·','èªè¨¼'], difficulty:1}
];

/********************
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 ********************/
const $ = sel => document.querySelector(sel);
function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function zenkakuToHankakuDigits(s){return s.replace(/[ï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0));}

/********************
 * çŠ¶æ…‹
 ********************/
let state = {
  order: [], answers: {}, current: 0, startedAt: null, endsAt: null,
  submitted: false, score: 0, tagStats: {}
};

/********************
 * åˆæœŸåŒ–
 ********************/
function init(){
  document.title = CONFIG.title + ' - CBT ä¸€å•ä¸€ç­”';
  const saved = load();
  if(saved){ state = {...state, ...saved}; }
  if(!state.order.length){
    const ids = QUESTIONS.map(q=>q.id);
    state.order = CONFIG.shuffleQuestions ? shuffle(ids) : ids;
  }
  if(CONFIG.timeLimitMinutes>0 && !state.endsAt){
    const now = Date.now();
    state.startedAt = now;
    state.endsAt = now + CONFIG.timeLimitMinutes*60*1000;
  }
  render();
  setupKeys();
  tick();
}

/********************
 * ä¿å­˜/èª­è¾¼
 ********************/
function save(){ try{ localStorage.setItem(CONFIG.persistKey, JSON.stringify(state)); }catch(e){} }
function load(){ try{ const raw = localStorage.getItem(CONFIG.persistKey); if(!raw) return null; const obj = JSON.parse(raw); if(!obj || !Array.isArray(obj.order)) return null; return obj; }catch(e){ return null; } }
function resetAll(){ localStorage.removeItem(CONFIG.persistKey); location.reload(); }

/********************
 * ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
 ********************/
function render(){
  const total = state.order.length;
  const idx = clamp(state.current,0,total-1);
  state.current = idx;
  const q = getQuestionByOrder(idx);

  // ãƒ¡ã‚¿ & é€²æ—
  $('#meta').textContent = `${CONFIG.title} â€” å•é¡Œ ${idx+1} / ${total}`;
  $('#progress').style.width = `${((idx)/Math.max(1,total-1))*100}%`;

  const screen = $('#screen');
  screen.textContent = '';

  if(state.submitted){ screen.appendChild(renderResult()); return; }

  const card = document.createElement('div');
  card.className = 'question-card';

  const fs = document.createElement('fieldset');
  fs.setAttribute('role','group');
  const lg = document.createElement('legend');
  lg.textContent = q.stem;
  fs.appendChild(lg);

  if(q.type==='single'){
    const optsWrap = document.createElement('div');
    optsWrap.className = 'opts';
    (q.options||[]).forEach((text,i)=>{
      const id = `opt-${q.id}-${i}`;
      const label = document.createElement('label');
      label.className = 'opt';
      label.setAttribute('for', id);
      const input = document.createElement('input');
      input.type = 'radio'; input.name = `q-${q.id}`; input.id = id; input.value = i;
      const saved = state.answers[q.id];
      if(saved && saved.type==='single' && saved.choiceIndex===i){ input.checked = true; }
      input.addEventListener('change',()=>{ state.answers[q.id] = {type:'single', choiceIndex: Number(input.value)}; save(); });
      const txt = document.createElement('span'); txt.textContent = text;
      label.appendChild(input); label.appendChild(txt); optsWrap.appendChild(label);
    });
    fs.appendChild(optsWrap);
  } else if(q.type==='short'){
    const inp = document.createElement('input');
    inp.type = 'text';
    inp.placeholder = 'è§£ç­”ã‚’å…¥åŠ›â€¦';
    inp.autocomplete = 'off';
    inp.spellcheck = false;
    inp.className = 'opt';
    const saved = state.answers[q.id];
    if(saved && saved.type==='short'){ inp.value = saved.text; }
    inp.addEventListener('input',()=>{ state.answers[q.id] = {type:'short', text: inp.value}; save(); });
    fs.appendChild(inp);
  }

  card.appendChild(fs);

  const nav = document.createElement('div'); nav.className = 'nav';
  const back = document.createElement('button'); back.textContent = 'â† æˆ»ã‚‹'; back.className = 'secondary'; back.disabled = state.current===0 || !CONFIG.allowReviewBeforeSubmit; back.addEventListener('click',()=>{ state.current = clamp(state.current-1,0,total-1); save(); render(); });
  const next = document.createElement('button'); next.textContent = (state.current===total-1) ? 'è§£ç­”ã‚’é€ä¿¡' : 'æ¬¡ã¸ â†’'; next.addEventListener('click',()=>{ if(state.current===total-1){ submitAnswers(); } else { state.current = clamp(state.current+1,0,total-1); save(); render(); } });
  nav.appendChild(back); nav.appendChild(next); card.appendChild(nav);
  screen.appendChild(card);
}

function renderResult(){
  const wrap = document.createElement('div'); wrap.className = 'result';
  const h = document.createElement('h2'); h.textContent = 'çµæœ'; wrap.appendChild(h);

  const stats = document.createElement('div'); stats.className = 'grid';
  const total = state.order.length; const percent = Math.round((state.score/total)*100);
  stats.appendChild(stat('å¾—ç‚¹', `${state.score} / ${total}ï¼ˆ${percent}%ï¼‰`));
  if(CONFIG.timeLimitMinutes>0){ const remained = Math.max(0, state.endsAt - Date.now()); const used = CONFIG.timeLimitMinutes*60*1000 - remained; stats.appendChild(stat('çµŒéæ™‚é–“', fmtTime(used))); }
  const tagBox = document.createElement('div'); tagBox.className = 'stat';
  const tagTitle = document.createElement('div'); tagTitle.style.fontWeight='700'; tagTitle.textContent = 'åˆ†é‡åˆ¥æ­£ç­”'; tagBox.appendChild(tagTitle);
  const ul = document.createElement('ul'); ul.className = 'muted'; Object.entries(state.tagStats).forEach(([tag, {count, correct}])=>{ const li = document.createElement('li'); const pct = Math.round((correct/count)*100); li.textContent = `${tag}: ${correct}/${count}ï¼ˆ${pct}%ï¼‰`; ul.appendChild(li); }); tagBox.appendChild(ul);
  stats.appendChild(tagBox); wrap.appendChild(stats);

  if(CONFIG.showExplanationAfterSubmit){
    const review = document.createElement('div'); review.className = 'panel';
    const title = document.createElement('div'); title.style.fontWeight='700'; title.style.marginBottom='8px'; title.textContent = 'è§£èª¬ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæ­£è§£ã®ã¿ï¼‰'; review.appendChild(title);
    let anyShown = false;
    state.order.forEach((qid, idx)=>{
      const q = QUESTIONS.find(x=>x.id===qid); const your = state.answers[qid]; const correct = isCorrect(q, your); if(!correct) return;
      const block = document.createElement('div'); block.className = 'explain correct';
      const stem = document.createElement('div'); stem.innerHTML = `<strong>Q${idx+1}.</strong> ${escapeHtml(q.stem)}`;
      const you = document.createElement('div'); you.className = 'muted'; you.textContent = 'ã‚ãªãŸã®è§£ç­”: ' + formatYourAnswer(q, your);
      const ans = document.createElement('div'); ans.textContent = 'æ­£è§£: ' + formatCorrect(q);
      const tag = document.createElement('div'); tag.className = 'muted'; tag.textContent = q.tags?.join(', ') || '';
      const exp = document.createElement('div'); exp.textContent = q.explanation || '';
      block.appendChild(stem); block.appendChild(you); block.appendChild(ans); if(q.tags?.length) block.appendChild(tag); if(q.explanation) block.appendChild(exp);
      review.appendChild(block); anyShown = true;
    });
    if(!anyShown){ const none = document.createElement('div'); none.className = 'muted'; none.textContent = 'æ­£è§£ã—ãŸå•é¡Œã®è§£èª¬ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚'; review.appendChild(none); }
    wrap.appendChild(review);
  }

  const actions = document.createElement('div'); actions.className = 'nav';
  const retry = document.createElement('button'); retry.textContent = 'ã‚‚ã†ä¸€åº¦ã‚„ã‚‹'; retry.addEventListener('click', ()=> resetAll());
  const exportBtn = document.createElement('button'); exportBtn.className = 'secondary'; exportBtn.textContent = 'çµæœã‚’JSONã§ä¿å­˜';
  exportBtn.addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify({score: state.score, answers: state.answers, tagStats: state.tagStats}, null, 2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'result.json'; a.click(); URL.revokeObjectURL(url); });
  actions.appendChild(retry); actions.appendChild(exportBtn); wrap.appendChild(actions);
  return wrap;
}
function stat(label, value){ const d = document.createElement('div'); d.className = 'stat'; d.innerHTML = `<div class="muted">${label}</div><div style="font-size:20px;font-weight:700">${value}</div>`; return d; }

/********************
 * æ¡ç‚¹
 ********************/
function submitAnswers(){
  let score = 0; const tagStats = {};
  state.order.forEach(qid=>{
    const q = QUESTIONS.find(x=>x.id===qid); const a = state.answers[qid]; const ok = isCorrect(q,a); if(ok) score++;
    (q.tags||['(æœªåˆ†é¡)']).forEach(tag=>{ if(!tagStats[tag]) tagStats[tag] = {count:0, correct:0}; tagStats[tag].count += 1; tagStats[tag].correct += ok ? 1 : 0; });
  });
  state.score = score; state.tagStats = tagStats; state.submitted = true; save(); render();
}

function isCorrect(q, a){
  if(!a) return false;
  if(q.type==='single'){ return a.choiceIndex === q.correctIndex; }
  else if(q.type==='short'){ const text = zenkakuToHankakuDigits((a.text||'').trim()); if(!(q.answerPattern instanceof RegExp)) return false; return q.answerPattern.test(text); }
  return false;
}

function formatYourAnswer(q, a){ if(!a) return 'æœªå›ç­”'; if(q.type==='single') return q.options[a.choiceIndex] ?? '(æœªé¸æŠ)'; if(q.type==='short') return a.text || '(æœªå…¥åŠ›)'; }
function formatCorrect(q){ if(q.type==='single') return q.options[q.correctIndex]; if(q.type==='short') return q.answerPattern.toString(); }

/********************
 * ã‚¿ã‚¤ãƒãƒ¼
 ********************/
function fmtTime(ms){ const t = Math.max(0, Math.floor(ms/1000)); const m = Math.floor(t/60).toString().padStart(2,'0'); const s = (t%60).toString().padStart(2,'0'); return `${m}:${s}`; }
function tick(){ if(CONFIG.timeLimitMinutes>0 && state.endsAt){ const remain = state.endsAt - Date.now(); $('#timer').textContent = fmtTime(remain); if(remain<=0 && !state.submitted){ submitAnswers(); } } else { $('#timer').textContent = '--:--'; } requestAnimationFrame(()=>setTimeout(tick, 250)); }

/********************
 * å…¥åŠ›ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰
 ********************/
function setupKeys(){
  window.addEventListener('keydown', (e)=>{
    if(state.submitted) return;
    // Backspaceã§ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹å‹•ä½œã‚’é˜²æ­¢ï¼ˆå…¥åŠ›æ¬„ä»¥å¤–ï¼‰
    if(e.key==='Backspace'){
      const t = e.target; const isEditable = t.isContentEditable || (t.tagName==='INPUT' || t.tagName==='TEXTAREA');
      if(!isEditable){ e.preventDefault(); }
      return; // ä»¥é™ã®å‡¦ç†ã¯ã—ãªã„
    }
    const q = getQuestionByOrder(state.current);
    if(e.key>='1' && e.key<='9' && q.type==='single'){
      const idx = Number(e.key)-1;
      const radios = document.querySelectorAll(`input[name="q-${q.id}"]`);
      if(radios[idx]){ radios[idx].checked = true; radios[idx].dispatchEvent(new Event('change')); }
    }
    if(e.key==='Enter'){
      const total = state.order.length;
      if(state.current===total-1){ submitAnswers(); }
      else { state.current = clamp(state.current+1,0,total-1); save(); render(); }
    }
  });
}

/********************
 * è£œåŠ©
 ********************/
function getQuestionByOrder(i){ const qid = state.order[i]; return QUESTIONS.find(q=>q.id===qid); }
function escapeHtml(s){ return String(s).replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c])); }

// èµ·å‹•
init();
</script>
</body>
</html>